angular.module("dietitian").controller("personCtl",function($scope,$log,$uibModal,personDb,state,remoting){function getPerson(lineId){$scope.ui.remoting.setIsRemoting(!0),$scope.ui.remoting.setStatus("プロフィールをリロードしています"),personDb.getPerson(state.person.line_id).then(function(response){$log.log(response),$scope.ui.remoting.setIsRemoting(!1),state.person=response.data},function(error){$scope.ui.remoting.setIsRemoting(!1),$log.error(error)})}$scope.ui={person:state.person,remoting:angular.copy(remoting)},$scope.state=state,$scope.getSexLabel=function(sex){var sexLabel="";return"male"==sex?sexLabel="男":"female"==sex&&(sexLabel="女"),sexLabel},$scope.openPersonForm=function(person){$uibModal.open({controller:"personFormCtl",templateUrl:"personForm",resolve:{person:angular.copy(state.person)}}).result.then(function(){state.reloadPerson()})},$scope.$watch("state.person",function(newVal,oldVal){newVal!==oldVal&&($scope.ui.person=newVal)}),$scope.$watch("state.requestReloadPerson",function(newVal,oldVal){newVal!=oldVal&&getPerson(state.person.line_id)}),1==state.person.first_login&&$scope.openPersonForm(state.person)}).controller("personFormCtl",function($scope,$uibModalInstance,$log,person,personDb,remoting){function clearAlert(){$scope.ui.alertList=[]}function pushAlert(alert){$scope.ui.alertList.push(alert)}person.birthday=new Date(1e3*person.birthday),$scope.ui={person:person,birthdayPickerOpen:!1,alertList:[],remoting:angular.copy(remoting)},$scope.toggleBirthdayPicker=function(){$scope.ui.birthdayPickerOpen=!$scope.ui.birthdayPickerOpen},$scope.updatePerson=function(person){clearAlert();var personForUpdate=angular.copy(person);try{personForUpdate.birthday=personForUpdate.birthday.getTime()/1e3}catch(e){return void pushAlert("誕生日が正しく入力されていません。")}delete personForUpdate.requiredCalorie,delete personForUpdate.requiredNutrition,$scope.ui.remoting.setIsRemoting(!0),$scope.ui.remoting.setStatus("プロフィールを更新しています"),personDb.updatePerson(personForUpdate).then(function(){$scope.ui.remoting.setIsRemoting(!1),$uibModalInstance.close()},function(error){$scope.ui.remoting.setIsRemoting(!1),$log.error("Failed to update person."),$log.error(error)})}});